<div *ngIf="product" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Breadcrumb -->
  <nav class="text-sm mb-6">
    <ol class="flex items-center space-x-2 text-gray-600">
      <li><a routerLink="/" class="hover:text-primary-600">Home</a></li>
      <li>/</li>
      <li><a routerLink="/products" class="hover:text-primary-600">Products</a></li>
      <li>/</li>
      <li class="text-gray-900">{{ product.name }}</li>
    </ol>
  </nav>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 mb-12">
    <!-- Image Gallery -->
    <div>
      <div class="mb-4">
        <img
          [src]="product.images[selectedImageIndex]"
          [alt]="product.name"
          class="w-full h-96 lg:h-[500px] object-cover rounded-lg"
        />
      </div>
      <div class="grid grid-cols-4 gap-4">
        <button
          *ngFor="let image of product.images; let i = index"
          (click)="selectImage(i)"
          [class.ring-2]="selectedImageIndex === i"
          [class.ring-primary-500]="selectedImageIndex === i"
          class="rounded-lg overflow-hidden"
        >
          <img
            [src]="image"
            [alt]="product.name + ' ' + (i + 1)"
            class="w-full h-24 object-cover"
          />
        </button>
      </div>
    </div>

    <!-- Product Info -->
    <div>
      <div class="mb-4">
        <span class="text-primary-600 font-semibold">{{ product.brand }}</span>
        <div class="flex items-center space-x-2 mt-2">
          <span *ngFor="let tag of product.tags" class="bg-primary-100 text-primary-700 px-2 py-1 rounded text-xs font-medium">
            {{ tag }}
          </span>
        </div>
      </div>
      
      <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">{{ product.name }}</h1>
      
      <div class="flex items-center space-x-4 mb-6">
        <div class="flex items-center">
          <div class="flex text-yellow-400">
            <span *ngFor="let star of [1,2,3,4,5]">
              <svg *ngIf="star <= product.rating" class="w-5 h-5 fill-current" viewBox="0 0 20 20">
                <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
              </svg>
              <svg *ngIf="star > product.rating" class="w-5 h-5 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
              </svg>
            </span>
          </div>
          <span class="ml-2 text-gray-600">({{ product.reviewCount }} reviews)</span>
        </div>
      </div>

      <div class="mb-6">
        <div class="flex items-baseline space-x-4 mb-2">
          <span class="text-4xl font-bold text-gray-900">{{ formatPrice(product.price) }}</span>
          <span *ngIf="product.originalPrice" class="text-2xl text-gray-500 line-through">
            {{ formatPrice(product.originalPrice) }}
          </span>
          <span *ngIf="product.discount" class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-sm font-bold">
            Save {{ product.discount }}%
          </span>
        </div>
        <p class="text-green-600 font-semibold" *ngIf="product.inStock">
          ‚úÖ In Stock ({{ product.stockCount }} available)
        </p>
        <p class="text-red-600 font-semibold" *ngIf="!product.inStock">
          ‚ùå Out of Stock
        </p>
      </div>

      <!-- Quantity Selector -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">Quantity</label>
        <div class="flex items-center space-x-4">
          <button
            (click)="decreaseQuantity()"
            [disabled]="quantity <= 1"
            class="w-10 h-10 rounded-lg border border-gray-300 flex items-center justify-center hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            ‚àí
          </button>
          <span class="text-xl font-semibold w-12 text-center">{{ quantity }}</span>
          <button
            (click)="increaseQuantity()"
            [disabled]="quantity >= product.stockCount"
            class="w-10 h-10 rounded-lg border border-gray-300 flex items-center justify-center hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            +
          </button>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-col sm:flex-row gap-4 mb-8">
        <button
          (click)="addToCart()"
          [disabled]="!product.inStock"
          class="flex-1 btn-primary py-4 text-lg disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Add to Cart
        </button>
        <button
          (click)="addToWishlist()"
          [class]="isInWishlist() ? 'bg-red-600 hover:bg-red-700 text-white border-red-600 py-4 px-8 text-lg rounded-lg font-semibold transition-colors' : 'btn-outline py-4 px-8 text-lg'"
        >
          {{ isInWishlist() ? '‚ù§Ô∏è In Wishlist' : 'ü§ç Add to Wishlist' }}
        </button>
      </div>

      <!-- Key Features -->
      <div class="border-t border-gray-200 pt-6">
        <h3 class="font-semibold text-gray-900 mb-4">Key Features</h3>
        <ul class="space-y-2 text-gray-600">
          <li class="flex items-start">
            <span class="text-green-500 mr-2">‚úì</span>
            <span>Free Shipping on orders over ‚Çπ50,000</span>
          </li>
          <li class="flex items-start">
            <span class="text-green-500 mr-2">‚úì</span>
            <span>30-Day Return Policy</span>
          </li>
          <li class="flex items-start">
            <span class="text-green-500 mr-2">‚úì</span>
            <span>Secure Payment</span>
          </li>
          <li class="flex items-start">
            <span class="text-green-500 mr-2">‚úì</span>
            <span>24/7 Customer Support</span>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="border-b border-gray-200 mb-8">
    <nav class="flex space-x-8">
      <button
        (click)="setTab('description')"
        [class.text-primary-600]="activeTab === 'description'"
        [class.border-primary-600]="activeTab === 'description'"
        class="py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"
      >
        Description
      </button>
      <button
        (click)="setTab('specifications')"
        [class.text-primary-600]="activeTab === 'specifications'"
        [class.border-primary-600]="activeTab === 'specifications'"
        class="py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"
      >
        Specifications
      </button>
      <button
        (click)="setTab('reviews')"
        [class.text-primary-600]="activeTab === 'reviews'"
        [class.border-primary-600]="activeTab === 'reviews'"
        class="py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"
      >
        Reviews ({{ product.reviewCount }})
      </button>
    </nav>
  </div>

  <!-- Tab Content -->
  <div class="mb-12">
    <!-- Description -->
    <div *ngIf="activeTab === 'description'" class="prose max-w-none">
      <p class="text-gray-700 leading-relaxed text-lg">{{ product.description }}</p>
    </div>

    <!-- Specifications -->
    <div *ngIf="activeTab === 'specifications' && product.specifications" class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div *ngFor="let spec of product.specifications | keyvalue" class="flex justify-between py-3 border-b border-gray-200">
        <span class="font-medium text-gray-700">{{ spec.key }}</span>
        <span class="text-gray-600">{{ spec.value }}</span>
      </div>
    </div>

    <!-- Reviews -->
    <div *ngIf="activeTab === 'reviews'">
      <div *ngIf="product.reviews && product.reviews.length > 0" class="space-y-6 mb-8">
        <div *ngFor="let review of product.reviews" class="card p-6">
          <div class="flex items-start justify-between mb-4">
            <div class="flex items-center space-x-4">
              <div class="w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center">
                <span class="text-primary-600 font-semibold">{{ review.userName.charAt(0) }}</span>
              </div>
              <div>
                <h4 class="font-semibold text-gray-900">{{ review.userName }}</h4>
                <div class="flex items-center space-x-2">
                  <div class="flex text-yellow-400">
                    <span *ngFor="let star of [1,2,3,4,5]">
                      <svg *ngIf="star <= review.rating" class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                        <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                      </svg>
                      <svg *ngIf="star > review.rating" class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                      </svg>
                    </span>
                  </div>
                  <span class="text-sm text-gray-500">{{ review.date }}</span>
                  <span *ngIf="review.verifiedPurchase" class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-medium">
                    Verified Purchase
                  </span>
                </div>
              </div>
            </div>
          </div>
          <h5 class="font-semibold text-gray-900 mb-2">{{ review.title }}</h5>
          <p class="text-gray-700 mb-4">{{ review.comment }}</p>
          <div class="flex items-center space-x-4 text-sm text-gray-500">
            <button class="hover:text-primary-600">Helpful ({{ review.helpful || 0 }})</button>
          </div>
        </div>
      </div>
      
      <div *ngIf="!product.reviews || product.reviews.length === 0" class="text-center py-12 text-gray-500">
        <p>No reviews yet. Be the first to review this product!</p>
      </div>

      <!-- Add Review Form -->
      <div class="card p-6 mt-8">
        <h3 class="text-xl font-semibold text-gray-900 mb-4">Write a Review</h3>
        <form (ngSubmit)="submitReview()" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Rating</label>
            <div class="flex items-center space-x-2">
              <button
                type="button"
                *ngFor="let star of [1,2,3,4,5]"
                (click)="newReview.rating = star"
                class="text-2xl focus:outline-none"
              >
                <span *ngIf="star <= newReview.rating" class="text-yellow-400">‚òÖ</span>
                <span *ngIf="star > newReview.rating" class="text-gray-300">‚òÜ</span>
              </button>
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Title</label>
            <input
              type="text"
              [(ngModel)]="newReview.title"
              name="title"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
              placeholder="Give your review a title"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Your Review</label>
            <textarea
              [(ngModel)]="newReview.comment"
              name="comment"
              required
              rows="4"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
              placeholder="Share your experience with this product"
            ></textarea>
          </div>

          <button
            type="submit"
            [disabled]="!newReview.title || !newReview.comment"
            class="btn-primary disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Submit Review
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<div *ngIf="!product" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 text-center">
  <p class="text-xl text-gray-600">Product not found</p>
  <a routerLink="/products" class="btn-primary mt-4 inline-block">Back to Products</a>
</div>
